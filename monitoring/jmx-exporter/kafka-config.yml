# JMX Exporter configuration for Kafka metrics

---
lowercaseOutputName: true
lowercaseOutputLabelNames: true

rules:
  # Broker metrics
  - pattern: kafka.server<type=(.+), name=(.+)><>Value
    name: kafka_server_$1_$2
    type: GAUGE

  # Topic metrics
  - pattern: kafka.server<type=BrokerTopicMetrics, name=(.+)><>Count
    name: kafka_server_brokertopicmetrics_$1_count
    type: COUNTER

  - pattern: kafka.server<type=BrokerTopicMetrics, name=(.+), topic=(.+)><>Count
    name: kafka_server_brokertopicmetrics_$1_count
    labels:
      topic: "$2"
    type: COUNTER

  # Request metrics
  - pattern: kafka.network<type=RequestMetrics, name=(.+), request=(.+)><>Count
    name: kafka_network_requestmetrics_$1_count
    labels:
      request: "$2"
    type: COUNTER

  - pattern: kafka.network<type=RequestMetrics, name=(.+), request=(.+)><>(Mean|Min|Max|StdDev)
    name: kafka_network_requestmetrics_$1_$3
    labels:
      request: "$2"
    type: GAUGE

  # Controller metrics
  - pattern: kafka.controller<type=KafkaController, name=(.+)><>Value
    name: kafka_controller_kafkacontroller_$1
    type: GAUGE

  # Replica manager
  - pattern: kafka.server<type=ReplicaManager, name=(.+)><>Value
    name: kafka_server_replicamanager_$1
    type: GAUGE

  # Log metrics
  - pattern: kafka.log<type=LogFlushStats, name=(.+)><>Count
    name: kafka_log_logflushstats_$1_count
    type: COUNTER

  # Cluster metrics
  - pattern: kafka.cluster<type=Partition, name=(.+), topic=(.+), partition=(.+)><>Value
    name: kafka_cluster_partition_$1
    labels:
      topic: "$2"
      partition: "$3"
    type: GAUGE

  # Consumer group metrics
  - pattern: kafka.consumer<type=consumer-fetch-manager-metrics, client-id=(.+)><>(.+)
    name: kafka_consumer_fetch_manager_$2
    labels:
      client_id: "$1"
    type: GAUGE

  # Producer metrics
  - pattern: kafka.producer<type=producer-metrics, client-id=(.+)><>(.+)
    name: kafka_producer_$2
    labels:
      client_id: "$1"
    type: GAUGE
